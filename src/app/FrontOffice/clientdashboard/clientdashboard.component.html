<div class="dashboard-container">
  <!-- Header/Navbar -->
  <header class="dashboard-header">
    <div class="header-content">
      <!-- Logo on the left -->
      <div class="logo-section">
        <img src="images/tt-logo.png" alt="Tunisie Telecom" class="logo">
      </div>

      <!-- Navigation buttons in center -->
      <nav class="nav-section">
        <button class="nav-button" (click)="openReclamationModal()">
          <span class="nav-icon">üìù</span>
          R√©clamation
        </button>
        <button class="nav-button" (click)="openRenseignement()">
          <span class="nav-icon">üí¨</span>
          Renseignement
        </button>
      </nav>

      <!-- User menu on the right -->
      <div class="user-section">
        <div class="user-menu" (click)="toggleDropdown()" *ngIf="currentUser">
          <img 
            [src]="currentUser.photoUser || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM2Yzc1N2QiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAxMkM5LjUgMTIgNy41IDEwIDcuNSA3LjVTOS41IDMgMTIgM3MyIDQgNC41IDcuNVM5LjUgMTIgMTIgMTJaTTEyIDEzLjVjLTMgMC04IDEuNS04IDQuNXYyaDEydi0yYzAtM3MtNS00LjUtOC00LjVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+'"
            [alt]="currentUser.nomUser + ' ' + currentUser.prenomUser" 
            class="user-avatar"
            (error)="onImageError($event)"
          >
          <span class="user-name">{{ currentUser.nomUser + ' ' + currentUser.prenomUser }}</span>
          <span class="dropdown-arrow" [class.rotated]="isDropdownOpen">‚ñº</span>
          
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <div class="dropdown-header">
              <img 
                [src]="currentUser.photoUser || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM2Yzc1N2QiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAxMkM5LjUgMTIgNy41IDEwIDcuNSA3LjVTOS41IDMgMTIgM3MyIDQgNC41IDcuNVM5LjUgMTIgMTIgMTJaTTEyIDEzLjVjLTMgMC04IDEuNS04IDQuNXYyaDEydi0yYzAtM3M1LTQuNS04LTQuNVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo8L3N2Zz4='"
                [alt]="currentUser.nomUser + ' ' + currentUser.prenomUser" 
                class="dropdown-avatar"
                (error)="onImageError($event)"
              >
              <div class="dropdown-user-info">
                <div class="dropdown-name">{{ currentUser.nomUser + ' ' + currentUser.prenomUser }}</div>
                <div class="dropdown-email">{{ currentUser.emailUser }}</div>
                <div class="dropdown-info">Ligne: {{ currentUser.numeroLigne }}</div>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item" (click)="navigateToAccount()">
              <span class="dropdown-icon">üë§</span>
              Mon compte
            </button>
            <button class="dropdown-item" (click)="openChangePasswordModal()">
              <span class="dropdown-icon">üîë</span>
              Changer password
            </button>
            <button class="dropdown-item" (click)="openPhotoModal()">
              <span class="dropdown-icon">üì∑</span>
              Modifier photo
            </button>
            <button class="dropdown-item logout" (click)="logout()">
              <span class="dropdown-icon">üö™</span>
              D√©connexion
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Welcome Section -->
    <section class="welcome-section">
      <div class="welcome-content">
        <h1 class="welcome-title">Bienvenue, {{ currentUser.nomUser }} {{ currentUser.prenomUser }} !</h1>
        <p class="welcome-subtitle">G√©rez vos services Tunisie Telecom en toute simplicit√©</p>
      </div>
      <div class="welcome-stats">
        <div class="stat-card reclamations-card blinking" (click)="openReclamationsListModal()" style="cursor: pointer;">
          <div class="stat-icon">üìã</div>
          <div class="stat-info">
            <div class="stat-number">{{reclamationsList.length}} R√©clamation(s)</div>
            <div class="stat-label">Afficher R√©clamations</div>
          </div>
        </div>
        <!-- <div class="stat-card">
          <div class="stat-icon">üí≥üìä</div>
          <div class="stat-info">
            <div class="stat-number">125 DT</div>
            <div class="stat-label">Facture du mois</div>
          </div>
        </div>-->
        <div class="stat-card">
          <div class="stat-icon">üì±</div>
          <div class="stat-info">
            <div class="stat-number">85%</div>
            <div class="stat-label">Renseignement</div>
          </div>
        </div> 
      </div>
    </section>

    <!-- Services Section -->
    <section class="services-section">
      <h2 class="section-title">Nos Services</h2>
      <div class="services-grid">
        <div class="service-card" *ngFor="let service of services">
          <div class="service-header">
            <div class="service-icon">{{ service.icon }}</div>
            <h3 class="service-title">{{ service.title }}</h3>
          </div>
          <p class="service-description">{{ service.description }}</p>
          <ul class="service-features">
            <li *ngFor="let feature of service.features">{{ feature }}</li>
          </ul>
          <button class="service-button">En savoir plus</button>
        </div>
      </div>
    </section>

    <!-- News Section -->
    <section class="news-section">
      <h2 class="section-title">Actualit√©s</h2>
      <div class="news-grid">
        <article class="news-card" *ngFor="let article of news">
          <div class="news-header">
            <h3 class="news-title">{{ article.title }}</h3>
            <span class="news-date">{{ article.date }}</span>
          </div>
          <p class="news-content">{{ article.content }}</p>
          <button class="news-button">Lire la suite</button>
        </article>
      </div>
    </section>

    <!-- About Section -->
    <section class="about-section">
      <div class="about-content">
        <h2 class="section-title">√Ä propos de Tunisie Telecom</h2>
        <div class="about-grid">
          <div class="about-text">
            <p>
              Tunisie Telecom est l'op√©rateur historique et leader des t√©l√©communications en Tunisie. 
              Depuis plus de 20 ans, nous accompagnons les particuliers et les entreprises dans leur 
              transformation digitale.
            </p>
            <p>
              Avec un r√©seau de plus de 1000 points de vente et un service client disponible 24h/24, 
              nous nous engageons √† offrir la meilleure qualit√© de service √† nos clients.
            </p>
            <div class="about-stats">
              <div class="about-stat">
                <div class="about-stat-number">7M+</div>
                <div class="about-stat-label">Clients</div>
              </div>
              <div class="about-stat">
                <div class="about-stat-number">1000+</div>
                <div class="about-stat-label">Points de vente</div>
              </div>
              <div class="about-stat">
                <div class="about-stat-number">24/7</div>
                <div class="about-stat-label">Support client</div>
              </div>
            </div>
          </div>
          <div class="about-image">
            <div class="about-card">
              <h3>Notre Mission</h3>
              <p>Connecter la Tunisie au monde digital avec des solutions innovantes et accessibles.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="dashboard-footer">
    <div class="footer-content">
      <p>&copy; 2025 Tunisie Telecom. Tous droits r√©serv√©s.</p>
      <div class="footer-links">
        <a href="#" class="footer-link">Conditions d'utilisation</a>
        <a href="#" class="footer-link">Politique de confidentialit√©</a>
        <a href="#" class="footer-link">Contact</a>
      </div>
    </div>
  </footer>
</div>

<!-- Modal pour changer le mot de passe -->
<div class="modal-overlay" [class.show]="isChangePasswordModalOpen" (click)="closeChangePasswordModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Changer le mot de passe</h3>
      <button class="modal-close" (click)="closeChangePasswordModal()">√ó</button>
    </div>
    
    <form [formGroup]="changePasswordForm" (ngSubmit)="onChangePassword()" class="modal-form">
      <div class="form-group">
        <label for="oldPassword">Ancien mot de passe</label>
        <div class="password-input-container">
          <input 
            id="oldPassword"
            formControlName="oldPassword"
            [type]="showOldPassword ? 'text' : 'password'"
            class="form-input"
            placeholder="Entrez votre ancien mot de passe"
            [class.error]="changePasswordForm.get('oldPassword')?.invalid && changePasswordForm.get('oldPassword')?.touched"
          >
          <button 
            type="button" 
            class="password-toggle"
            (click)="toggleOldPasswordVisibility()"
            tabindex="-1"
          >
            {{ showOldPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
          </button>
        </div>
        <div class="error-message" *ngIf="changePasswordForm.get('oldPassword')?.invalid && changePasswordForm.get('oldPassword')?.touched">
          L'ancien mot de passe est requis
        </div>
      </div>

      <div class="form-group">
        <label for="newPassword">Nouveau mot de passe</label>
        <div class="password-input-container">
          <input 
            id="newPassword"
            formControlName="newPassword"
            [type]="showNewPassword ? 'text' : 'password'"
            class="form-input"
            placeholder="Entrez votre nouveau mot de passe"
            [class.error]="changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched"
          >
          <button 
            type="button" 
            class="password-toggle"
            (click)="toggleNewPasswordVisibility()"
            tabindex="-1"
          >
            {{ showNewPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
          </button>
        </div>
        <div class="error-message" *ngIf="changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched">
          Le nouveau mot de passe est requis (minimum 6 caract√®res)
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmer le nouveau mot de passe</label>
        <div class="password-input-container">
          <input 
            id="confirmPassword"
            formControlName="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            class="form-input"
            placeholder="Confirmez votre nouveau mot de passe"
            [class.error]="changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched"
          >
          <button 
            type="button" 
            class="password-toggle"
            (click)="toggleConfirmPasswordVisibility()"
            tabindex="-1"
          >
            {{ showConfirmPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
          </button>
        </div>
        <div class="error-message" *ngIf="changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched">
          <span *ngIf="changePasswordForm.get('confirmPassword')?.errors?.['required']">La confirmation du mot de passe est requise</span>
          <span *ngIf="changePasswordForm.get('confirmPassword')?.errors?.['passwordMismatch']">Les mots de passe ne correspondent pas</span>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="closeChangePasswordModal()">
          Annuler
        </button>
        <button 
          type="submit" 
          class="btn-submit" 
          [disabled]="changePasswordForm.invalid || isChangingPassword"
        >
          <span *ngIf="isChangingPassword">üîÑ Changement...</span>
          <span *ngIf="!isChangingPassword">Changer le mot de passe</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal pour les informations utilisateur -->
<div class="modal-overlay" [class.show]="isUserInfoModalOpen" (click)="closeUserInfoModal()">
  <div class="modal-content user-info-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Mon Compte</h3>
      <button class="modal-close" (click)="closeUserInfoModal()">√ó</button>
    </div>
    
    <div class="user-info-content">
      <!-- Photo de profil -->
      <div class="profile-photo-section">
        <div class="profile-photo-container" (click)="onProfilePhotoClick()" [class.updating]="isUpdatingPhoto">
          <img 
            [src]="currentUser?.photoUser || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjNmM3NTdkIi8+CjxzdmcgeD0iMjAiIHk9IjIwIiB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAxMkM5LjUgMTIgNy41IDEwIDcuNSA3LjVTOS41IDMgMTIgM3MyIDQgNC41IDcuNVM5LjUgMTIgMTIgMTJaTTEyIDEzLjVjLTMgMC04IDEuNS04IDQuNXYyaDEydi0yYzAtM3M1LTQuNS04LTQuNVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo8L3N2Zz4='"
            [alt]="currentUser?.nomUser + ' ' + currentUser?.prenomUser" 
            class="profile-photo"
            [class.updating]="isUpdatingPhoto"
            (error)="onImageError($event)"
          >
          
          <!-- Overlay pour indiquer que la photo est cliquable -->
          <div class="photo-overlay" [class.show]="!isUpdatingPhoto">
            <div class="photo-edit-icon">üì∑</div>
            <span class="photo-edit-text">Changer la photo</span>
          </div>
          
          <!-- Indicateur de chargement -->
          <div class="photo-loading" [class.show]="isUpdatingPhoto">
            <div class="loading-spinner"></div>
            <span class="loading-text">Mise √† jour...</span>
          </div>
        </div>
        <h4 class="profile-name">{{ currentUser?.prenomUser }} {{ currentUser?.nomUser }}</h4>
        <!-- <h4 class="profile-name">{{ currentUser?.prenomUser }} {{ currentUser?.nomUser }}</h4> -->
        <p class="profile-role">{{ currentUser?.role === 'ROLE_CLIENT' ? 'Client' : currentUser?.role }}</p>
      </div>

      <!-- Informations personnelles -->
      <div class="info-section">
        <h5 class="section-title">
          <span class="section-icon">üë§</span>
          Informations personnelles
        </h5>
        <div class="info-grid">
          <div class="info-item">
            <label class="info-label">Pr√©nom</label>
            <span class="info-value">{{ currentUser?.prenomUser || 'Non renseign√©' }}</span>
          </div>
          <div class="info-item">
            <label class="info-label">Nom</label>
            <span class="info-value">{{ currentUser?.nomUser || 'Non renseign√©' }}</span>
          </div>
          <div class="info-item">
            <label class="info-label">Email</label>
            <span class="info-value">{{ currentUser?.emailUser || 'Non renseign√©' }}</span>
          </div>
          <div class="info-item">
            <label class="info-label">R√¥le</label>
            <span class="info-value role-badge" [class]="currentUser?.role?.toLowerCase()">
              {{ currentUser?.role === 'ROLE_CLIENT' ? 'Client' : currentUser?.role === 'ROLE_ADMIN' ? 'Administrateur' : currentUser?.role }}
            </span>
          </div>
        </div>
      </div>

      <!-- Informations de service -->
      <div class="info-section">
        <h5 class="section-title">
          <span class="section-icon">üìû</span>
          Informations de service
        </h5>
        <div class="info-grid">
          <div class="info-item">
            <label class="info-label">Num√©ro de ligne</label>
            <span class="info-value">{{ currentUser?.numeroLigne || 'Non renseign√©' }}</span>
          </div>
          <div class="info-item">
            <label class="info-label">√âtat du compte</label>
            <span class="info-value status-badge" [class]="currentUser?.etatCompte?.toLowerCase()">
              {{ currentUser?.etatCompte || 'Non renseign√©' }}
            </span>
          </div>
          <div class="info-item full-width">
            <label class="info-label">carte d'identit√©</label>
            <div class="info-value document-container" *ngIf="currentUser?.documentContrat; else noDocument">
              <!-- Si c'est une image -->
              <div *ngIf="isImageFile(currentUser.documentContrat)" class="document-image-container">
                <img 
                  [src]="currentUser.documentContrat" 
                  alt="Document de contrat" 
                  class="document-image"
                  (click)="openDocumentViewer(currentUser.documentContrat, 'image')"
                  (error)="onDocumentError($event)"
                >
                <button class="view-document-btn" (click)="openDocumentViewer(currentUser.documentContrat, 'image')">
                  <span class="btn-icon">üîç</span>
                  Voir l'image
                </button>
              </div>
              
              <!-- Si c'est un PDF -->
              <div *ngIf="isPdfFile(currentUser.documentContrat)" class="document-pdf-container">
                <div class="pdf-icon">üìÑ</div>
                <div class="pdf-info">
                  <span class="pdf-name">Carte d'identit√©.pdf</span>
                  <span class="pdf-size">Carte PDF</span>
                </div>
                <button class="view-document-btn" (click)="openDocumentViewer(currentUser.documentContrat, 'pdf')">
                  <span class="btn-icon">üìñ</span>
                  Ouvrir PDF
                </button>
              </div>
              
              <!-- Si c'est un autre type de fichier -->
              <div *ngIf="!isImageFile(currentUser.documentContrat) && !isPdfFile(currentUser.documentContrat)" class="document-other-container">
                <div class="file-icon">üìé</div>
                <div class="file-info">
                  <span class="file-name">{{ getFileName(currentUser.documentContrat) }}</span>
                  <span class="file-type">Document</span>
                </div>
                <a [href]="currentUser.documentContrat" target="_blank" class="view-document-btn">
                  <span class="btn-icon">‚¨áÔ∏è</span>
                  T√©l√©charger
                </a>
              </div>
            </div>
            <ng-template #noDocument>
              <span class="info-value no-document">Aucun document</span>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Informations du compte -->
      <div class="info-section">
        <h5 class="section-title">
          <span class="section-icon">üÜî</span>
          Informations du compte
        </h5>
        <div class="info-grid">
          <div class="info-item">
            <label class="info-label">Identifiant Utilisateur</label>
            <span class="info-value">{{ currentUser?.emailUser || 'Non renseign√©' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-primary" (click)="closeUserInfoModal()">
        Fermer
      </button>
    </div>
  </div>
</div>



<!-- Modal pour modification de photo -->
  <div class="modal-overlay" [class.show]="isPhotoModalOpen" (click)="closePhotoModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Modifier la photo de profil</h2>
        <button class="modal-close" (click)="closePhotoModal()">√ó</button>
      </div>
      
      <div class="modal-body">
        <div class="photo-upload-section">
          <div class="current-photo" *ngIf="currentUser">
            <img 
              [src]="currentUser.photoUser || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjMjhhNzQ1Ii8+CjxzdmcgeD0iMjAiIHk9IjIwIiB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAxMkM5LjUgMTIgNy41IDEwIDcuNSA3LjVTOS41IDMgMTIgM3MyIDQgNC41IDcuNVM5LjUgMTIgMTIgMTJaTTEyIDEzLjVjLTMgMC04IDEuNS04IDQuNXYyaDEydi0yYzAtM3MtNS00LjUtOC00LjVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+'"
              [alt]="currentUser.nomUser + ' ' + currentUser.prenomUser" 
              class="current-photo-img"
              (error)="onImageError($event)"
            >
          </div>
          
          <div class="upload-instructions">
            <h4>Instructions :</h4>
            <ul>
              <li>Formats accept√©s : JPG, PNG, GIF</li>
              <li>Taille maximale : 5 MB</li>
              <li>Dimensions recommand√©es : 400x400 pixels</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closePhotoModal()">
          Annuler
        </button>
        <button type="button" class="btn btn-primary" (click)="onProfilePhotoClick()" [disabled]="isUpdatingPhoto">
          <span *ngIf="isUpdatingPhoto">üîÑ Upload...</span>
          <span *ngIf="!isUpdatingPhoto">üì∑ S√©lectionner une photo</span>
        </button>
      </div>
    </div>
  </div>

<!-- Modal pour cr√©er une r√©clamation -->
<div class="modal-overlay" [class.show]="isReclamationModalOpen" (click)="closeReclamationModal()">
  <div class="modal-content reclamation-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">üìù Cr√©er une r√©clamation</h3>
      <div class="header-actions">
        <button class="list-reclamations-btn-header" (click)="openReclamationsListModal(); closeReclamationModal()">
          <span class="btn-icon">üìã</span>
          Lister mes r√©clamations
        </button>
        <button class="modal-close" (click)="closeReclamationModal()">√ó</button>
      </div>
    </div>
    
    <div class="modal-body">
      <!-- Message d'information sur la limitation -->
      <div class="info-banner">
        <div class="info-icon">‚ö†Ô∏è</div>
        <div class="info-content">
          <h5>Information importante</h5>
          <p>Vous ne pouvez cr√©er qu'<strong>une seule r√©clamation par heure</strong> pour assurer un traitement optimal de votre demande.</p>
        </div>
      </div>

      <form [formGroup]="reclamationForm" class="reclamation-form">
        <!-- Type de r√©clamation -->
        <div class="form-group">
          <label for="typeRecl" class="form-label">
            <span class="label-icon">üè∑Ô∏è</span>
            Type de r√©clamation *
          </label>
          <select 
            id="typeRecl" 
            formControlName="typeRecl" 
            class="form-input"
            [class.error]="reclamationForm.get('typeRecl')?.invalid && reclamationForm.get('typeRecl')?.touched"
          >
            <option value="">S√©lectionnez un type</option>
            <option value="Mon_compte_MY_TT">Mon compte MY TT</option>
            <option value="Mon_Mobile">Mon Mobile</option>
            <option value="Internet_Mobile">Internet Mobile</option>
            <option value="Mon_Fixe">Mon Fixe</option>
            <option value="Service_e_Facture">Service e-Facture</option>
          </select>
          <div class="error-message" *ngIf="reclamationForm.get('typeRecl')?.invalid && reclamationForm.get('typeRecl')?.touched">
            Le type de r√©clamation est requis
          </div>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="descriptionRecl" class="form-label">
            <span class="label-icon">üìù</span>
            Description du probl√®me *
          </label>
          <textarea 
            id="descriptionRecl"
            formControlName="descriptionRecl"
            class="form-textarea"
            rows="4"
            placeholder="D√©crivez votre probl√®me en d√©tail..."
            [class.error]="reclamationForm.get('descriptionRecl')?.invalid && reclamationForm.get('descriptionRecl')?.touched"
          ></textarea>
          <div class="char-counter">
            {{ reclamationForm.get('descriptionRecl')?.value?.length || 0 }}/500 caract√®res
          </div>
          <div class="error-message" *ngIf="reclamationForm.get('descriptionRecl')?.invalid && reclamationForm.get('descriptionRecl')?.touched">
            <span *ngIf="reclamationForm.get('descriptionRecl')?.errors?.['required']">La description est requise</span>
            <span *ngIf="reclamationForm.get('descriptionRecl')?.errors?.['minlength']">La description doit contenir au moins 10 caract√®res</span>
            <span *ngIf="reclamationForm.get('descriptionRecl')?.errors?.['maxlength']">La description ne peut pas d√©passer 500 caract√®res</span>
          </div>
        </div>

        <!-- Section des fichiers en ligne -->
        <div class="files-row">
          <!-- Capture d'√©cran -->
          <div class="form-group file-group">
            <label class="form-label">
              <span class="label-icon">üì∑</span>
              Capture d'√©cran (optionnel)
            </label>
            <div class="file-upload-container">
              <input 
                type="file" 
                id="captureFileInput" 
                accept=".png,.jpg,.jpeg" 
                (change)="onCaptureFileSelected($event)"
                class="file-input"
                hidden
              >
              <button 
                type="button" 
                class="file-upload-btn"
                (click)="triggerCaptureUpload()"
                [disabled]="isUploadingCapture"
              >
                <span class="upload-icon">üì∑</span>
                <span *ngIf="!isUploadingCapture && !selectedCaptureFile">Choisir une image</span>
                <span *ngIf="isUploadingCapture">üîÑ Upload...</span>
                <span *ngIf="!isUploadingCapture && selectedCaptureFile">Changer l'image</span>
              </button>
              <div class="file-info" *ngIf="selectedCaptureFile">
                <div class="file-details">
                  <div class="file-name">{{ selectedCaptureFile.name }}</div>
                  <div class="file-size">({{ formatFileSize(selectedCaptureFile.size) }})</div>
                </div>
                <button type="button" class="remove-file-btn" (click)="removeCaptureFile()">‚ùå</button>
              </div>
              <div class="upload-hint">
                <small>Formats accept√©s : PNG, JPG, JPEG (max 5MB)</small>
              </div>
              
              <!-- Pr√©visualisation de l'image en temps r√©el -->
              <div class="file-preview" *ngIf="selectedCaptureFile && capturePreviewUrl">
                <div class="preview-header">
                  <span class="preview-icon">üëÅÔ∏è</span>
                  <span class="preview-title">Aper√ßu de l'image</span>
                </div>
                <div class="image-preview-container">
                  <img [src]="capturePreviewUrl" [alt]="selectedCaptureFile.name" class="preview-image">
                  <div class="image-overlay">
                    <button type="button" class="zoom-btn" (click)="openImagePreview(capturePreviewUrl, selectedCaptureFile.name)">
                      üîç Agrandir
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Document -->
          <div class="form-group file-group">
            <label class="form-label">
              <span class="label-icon">üìÑ</span>
              Document justificatif (optionnel)
            </label>
            <div class="file-upload-container">
              <input 
                type="file" 
                id="documentFileInput" 
                accept=".pdf,.png,.jpg,.jpeg" 
                (change)="onDocumentFileSelected($event)"
                class="file-input"
                hidden
              >
              <button 
                type="button" 
                class="file-upload-btn"
                (click)="triggerDocumentUpload()"
                [disabled]="isUploadingDocument"
              >
                <span class="upload-icon">üìÑ</span>
                <span *ngIf="!isUploadingDocument && !selectedDocumentFile">Choisir un fichier</span>
                <span *ngIf="isUploadingDocument">üîÑ Upload...</span>
                <span *ngIf="!isUploadingDocument && selectedDocumentFile">Changer le fichier</span>
              </button>
              <div class="file-info" *ngIf="selectedDocumentFile">
                <div class="file-details">
                  <div class="file-name">{{ selectedDocumentFile.name }}</div>
                  <div class="file-size">({{ formatFileSize(selectedDocumentFile.size) }})</div>
                </div>
                <button type="button" class="remove-file-btn" (click)="removeDocumentFile()">‚ùå</button>
              </div>
              <div class="upload-hint">
                <small>Formats accept√©s : PDF, PNG, JPG, JPEG (max 10MB)</small>
              </div>
              
              <!-- Pr√©visualisation du document en temps r√©el -->
              <div class="file-preview" *ngIf="selectedDocumentFile">
                <div class="preview-header">
                  <span class="preview-icon">üëÅÔ∏è</span>
                  <span class="preview-title">Aper√ßu du document</span>
                </div>
                
                <!-- Pr√©visualisation pour images -->
                <div class="image-preview-container" *ngIf="isImageFile(selectedDocumentFile.type) && documentPreviewUrl">
                  <img [src]="documentPreviewUrl" [alt]="selectedDocumentFile.name" class="preview-image">
                  <div class="image-overlay">
                    <button type="button" class="zoom-btn" (click)="openImagePreview(documentPreviewUrl, selectedDocumentFile.name)">
                      üîç Agrandir
                    </button>
                  </div>
                </div>
                
                <!-- Pr√©visualisation pour PDF -->
                <div class="pdf-preview-container" *ngIf="isPdfFile(selectedDocumentFile.type)">
                  <div class="pdf-icon-large">üìÑ</div>
                  <div class="pdf-info">
                    <div class="pdf-name">{{ selectedDocumentFile.name }}</div>
                    <div class="pdf-size">{{ formatFileSize(selectedDocumentFile.size) }}</div>
                    <button type="button" class="view-pdf-btn" (click)="openPdfPreview(selectedDocumentFile)">
                      üìñ Ouvrir le PDF
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Informations client (automatiques) -->
        <div class="form-group client-info">
          <h4 class="info-title">
            <span class="info-icon">üë§</span>
            Informations du client
          </h4>
          <div class="info-grid">
            <div class="info-item">
              <label>Nom complet</label>
              <span>{{ currentUser?.prenomUser }} {{ currentUser?.nomUser }}</span>
            </div>
            <div class="info-item">
              <label>Email</label>
              <span>{{ currentUser?.emailUser }}</span>
            </div>
            <div class="info-item">
              <label>Num√©ro de ligne</label>
              <span>{{ currentUser?.numeroLigne || 'Non renseign√©' }}</span>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="closeReclamationModal()">
        Annuler
      </button>
      <button 
        type="button" 
        class="btn-submit" 
        (click)="submitReclamation()"
        [disabled]="reclamationForm.invalid || isSubmittingReclamation"
      >
        <span *ngIf="isSubmittingReclamation">üîÑ Envoi...</span>
        <span *ngIf="!isSubmittingReclamation">üìù Envoyer la r√©clamation</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal pour afficher la liste des r√©clamations -->
<div class="modal-overlay" [class.show]="isReclamationsListModalOpen" (click)="closeReclamationsListModal()">
  <div class="modal-content reclamations-list-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">üìã Mes R√©clamations</h3>
      <div class="header-actions">
        <button class="add-reclamation-btn-header" (click)="openReclamationModal(); closeReclamationsListModal()">
          <span class="btn-icon">üìù</span>
          Nouvelle r√©clamation
        </button>
        <button class="modal-close" (click)="closeReclamationsListModal()">√ó</button>
      </div>
    </div>
    
    <div class="modal-body">
      <!-- Filtres -->
      <div class="filters-section">
        <h4 class="filters-title">üîç Filtres</h4>
        <div class="filters-row">
          <div class="filter-group">
            <label for="filterType">Type :</label>
            <select 
              id="filterType" 
              [(ngModel)]="filterTypeRecl" 
              (change)="onFilterChange()"
              class="filter-select"
            >
              <option *ngFor="let option of typeReclOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="filterEtat">√âtat :</label>
            <select 
              id="filterEtat" 
              [(ngModel)]="filterEtatRecl" 
              (change)="onFilterChange()"
              class="filter-select"
            >
              <option *ngFor="let option of etatReclOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="filterId">ID :</label>
            <input 
              id="filterId" 
              type="text" 
              [(ngModel)]="filterIdRecl" 
              (input)="onFilterChange()"
              placeholder="Rechercher par ID..."
              class="filter-input"
            >
          </div>
          
          <div class="filter-actions">
            <button class="clear-filters-btn" (click)="clearFilters()">
              üîÑ Effacer
            </button>
          </div>
        </div>
      </div>
      
      <!-- Loading -->
      <div class="loading-section" *ngIf="isLoadingReclamations">
        <div class="loading-spinner"></div>
        <p>Chargement des r√©clamations...</p>
      </div>
      
      <!-- Liste des r√©clamations -->
      <div class="reclamations-list" *ngIf="!isLoadingReclamations">
        <div class="reclamations-header">
          <h4>
            üìä {{ filteredReclamationsList.length }} r√©clamation(s) 
            <span *ngIf="filteredReclamationsList.length !== reclamationsList.length">
              sur {{ reclamationsList.length }}
            </span>
          </h4>
        </div>
        
        <!-- Message si aucune r√©clamation -->
        <div class="no-reclamations" *ngIf="filteredReclamationsList.length === 0">
          <div class="no-data-icon">üì≠</div>
          <h5>Aucune r√©clamation trouv√©e</h5>
          <p *ngIf="reclamationsList.length === 0">Vous n'avez pas encore cr√©√© de r√©clamation.</p>
          <p *ngIf="reclamationsList.length > 0">Aucune r√©clamation ne correspond √† vos crit√®res de recherche.</p>
        </div>
        
        <!-- Cartes des r√©clamations -->
        <div class="reclamations-grid" *ngIf="filteredReclamationsList.length > 0">
          <div class="reclamation-card" *ngFor="let reclamation of filteredReclamationsList">
            <div class="reclamation-header">
              <div class="reclamation-id">
                <span class="id-label">ID:</span>
                <span class="id-value">#{{ reclamation.idRecl }}</span>
              </div>
              <div class="reclamation-status" [class]="getEtatReclClass(reclamation.etatRecl)">
                {{ getEtatReclLabel(reclamation.etatRecl) }}
              </div>
            </div>
            
            <div class="reclamation-body">
              <div class="reclamation-type">
                <span class="type-icon">üè∑Ô∏è</span>
                <span class="type-text">{{ getTypeReclLabel(reclamation.typeRecl) }}</span>
              </div>
              
              <div class="reclamation-description">
                <p>{{ reclamation.descriptionRecl }}</p>
              </div>
              
              <div class="reclamation-dates">
                <div class="date-item">
                  <span class="date-label">üìÖ Cr√©√©e le:</span>
                  <span class="date-value">{{ formatDate(reclamation.dateRecl) }}</span>
                </div>
                <div class="date-item" *ngIf="reclamation.dateReponRecl">
                  <span class="date-label">‚úÖ R√©pondue le:</span>
                  <span class="date-value">{{ formatDate(reclamation.dateReponRecl) }}</span>
                </div>
              </div>
              
              <!-- R√©ponse si disponible -->
              <div class="reclamation-response" *ngIf="reclamation.descriptionReponRecl">
                <h6>üí¨ R√©ponse:</h6>
                <p>{{ reclamation.descriptionReponRecl }}</p>
              </div>
              
              <!-- Fichiers joints -->
              <div class="reclamation-files" *ngIf="reclamation.captureRecl || reclamation.documentRecl">
                <h6>üìé Fichiers joints:</h6>
                <div class="files-list">
                  <div class="file-item" *ngIf="reclamation.captureRecl">
                    <span class="file-icon">üì∑</span>
                    <a [href]="reclamation.captureRecl" target="_blank" class="file-link">
                      Capture d'√©cran
                    </a>
                  </div>
                  <div class="file-item" *ngIf="reclamation.documentRecl">
                    <span class="file-icon">üìÑ</span>
                    <a [href]="reclamation.documentRecl" target="_blank" class="file-link">
                      Document
                    </a>
                  </div>
                </div>
              </div>
              
              <!-- Actions de la r√©clamation -->
              <div class="reclamation-actions">
                <button 
                  class="download-pdf-btn" 
                  (click)="downloadReclamationPdf(reclamation)"
                  title="T√©l√©charger le r√©c√©piss√© PDF"
                >
                  <span class="btn-icon">üìÑ</span>
                  T√©l√©charger votre re√ßu
                </button>

                <button 
                  class="edit-btn"
                  (click)="openEditReclamationModal(reclamation)"
                  title="Modifier cette r√©clamation"
                  [disabled]="!canEditReclamation(reclamation)"
                  [class.disabled]="!canEditReclamation(reclamation)"
                >
                  <span class="btn-icon">‚úèÔ∏è</span>
                  Modifier
                </button>

                <button 
                  class="delete-btn"
                  (click)="openDeleteConfirmation(reclamation)"
                  title="Supprimer cette r√©clamation"
                >
                  <span class="btn-icon">üóëÔ∏è</span>
                  Supprimer
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- <div class="modal-footer">
      <button class="btn-secondary" (click)="closeReclamationsListModal()">
        Fermer
      </button>
      <button class="btn-primary" (click)="openReclamationModal(); closeReclamationsListModal()">
        ‚ûï Nouvelle r√©clamation
      </button>
    </div> -->
  </div>
</div>

<!-- Modal de confirmation de suppression -->
<div class="modal-overlay" [class.show]="isDeleteConfirmationOpen" (click)="closeDeleteConfirmation()">
  <div class="modal-content delete-confirmation-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">üóëÔ∏è Confirmer la suppression</h3>
      <button class="modal-close" (click)="closeDeleteConfirmation()">√ó</button>
    </div>
    
    <div class="modal-body">
      <div class="confirmation-content" *ngIf="reclamationToDelete">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h4>√ätes-vous s√ªr de vouloir supprimer cette r√©clamation ?</h4>
        <div class="reclamation-details">
          <div class="detail-item">
            <span class="detail-label">ID :</span>
            <span class="detail-value">#{{ reclamationToDelete.idRecl }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Type :</span>
            <span class="detail-value">{{ getTypeReclLabel(reclamationToDelete.typeRecl) }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">√âtat :</span>
            <span class="detail-value status-badge" [class]="getEtatReclClass(reclamationToDelete.etatRecl)">
              {{ getEtatReclLabel(reclamationToDelete.etatRecl) }}
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Date :</span>
            <span class="detail-value">{{ formatDate(reclamationToDelete.dateRecl) }}</span>
          </div>
        </div>
        <div class="warning-message">
          <p><strong>‚ö†Ô∏è Attention :</strong> Cette action est irr√©versible. La r√©clamation sera d√©finitivement supprim√©e et ne pourra pas √™tre r√©cup√©r√©e.</p>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn-cancel" 
        (click)="closeDeleteConfirmation()"
        [disabled]="isDeletingReclamation"
      >
        Annuler
      </button>
      <button 
        type="button" 
        class="btn-delete" 
        (click)="confirmDeleteReclamation()"
        [disabled]="isDeletingReclamation"
      >
        <span *ngIf="isDeletingReclamation">üîÑ Suppression...</span>
        <span *ngIf="!isDeletingReclamation">üóëÔ∏è Supprimer d√©finitivement</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal pour modifier une r√©clamation -->
<div class="modal-overlay" [class.show]="isEditReclamationModalOpen" (click)="closeEditReclamationModal()">
  <div class="modal-content edit-reclamation-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">‚úèÔ∏è Modifier la r√©clamation</h3>
      <button class="modal-close" (click)="closeEditReclamationModal()">√ó</button>
    </div>
    
    <div class="modal-body" *ngIf="reclamationToEdit">
      <!-- Informations de la r√©clamation -->
      <div class="reclamation-info-section">
        <h4 class="info-title">üìã R√©clamation #{{ reclamationToEdit.idRecl }}</h4>
        <div class="reclamation-status-info">
          <span class="status-badge" [class]="getEtatReclClass(reclamationToEdit.etatRecl)">
            {{ getEtatReclLabel(reclamationToEdit.etatRecl) }}
          </span>
          <span class="creation-date">Cr√©√©e le {{ formatDate(reclamationToEdit.dateRecl) }}</span>
        </div>
      </div>

      <!-- Message d'information sur la limitation -->
      <div class="info-banner warning" *ngIf="!canEditReclamation(reclamationToEdit)">
        <div class="info-icon">‚ö†Ô∏è</div>
        <div class="info-content">
          <h5>Modification non autoris√©e</h5>
          <p>Seules les r√©clamations <strong>en attente</strong> peuvent √™tre modifi√©es. Cette r√©clamation est actuellement <strong>{{ getEtatReclLabel(reclamationToEdit.etatRecl).toLowerCase() }}</strong>.</p>
        </div>
      </div>

      <div class="info-banner" *ngIf="canEditReclamation(reclamationToEdit)">
        <div class="info-icon">‚ÑπÔ∏è</div>
        <div class="info-content">
          <h5>Modification autoris√©e</h5>
          <p>Vous pouvez modifier cette r√©clamation car elle est encore <strong>en attente</strong> de traitement.</p>
        </div>
      </div>

      <form [formGroup]="editReclamationForm" class="edit-reclamation-form" *ngIf="canEditReclamation(reclamationToEdit)">
        <!-- Type de r√©clamation -->
        <div class="form-group">
          <label for="editTypeRecl" class="form-label">
            <span class="label-icon">üè∑Ô∏è</span>
            Type de r√©clamation *
          </label>
          <select 
            id="editTypeRecl" 
            formControlName="typeRecl" 
            class="form-input"
            [class.error]="editReclamationForm.get('typeRecl')?.invalid && editReclamationForm.get('typeRecl')?.touched"
          >
            <option value="">S√©lectionnez un type</option>
            <option value="Mon_compte_MY_TT">Mon compte MY TT</option>
            <option value="Mon_Mobile">Mon Mobile</option>
            <option value="Internet_Mobile">Internet Mobile</option>
            <option value="Mon_Fixe">Mon Fixe</option>
            <option value="Service_e_Facture">Service e-Facture</option>
          </select>
          <div class="error-message" *ngIf="editReclamationForm.get('typeRecl')?.invalid && editReclamationForm.get('typeRecl')?.touched">
            Le type de r√©clamation est requis
          </div>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="editDescriptionRecl" class="form-label">
            <span class="label-icon">üìù</span>
            Description du probl√®me *
          </label>
          <textarea 
            id="editDescriptionRecl"
            formControlName="descriptionRecl"
            class="form-textarea"
            rows="4"
            placeholder="D√©crivez votre probl√®me en d√©tail..."
            [class.error]="editReclamationForm.get('descriptionRecl')?.invalid && editReclamationForm.get('descriptionRecl')?.touched"
          ></textarea>
          <div class="char-counter">
            {{ editReclamationForm.get('descriptionRecl')?.value?.length || 0 }}/500 caract√®res
          </div>
          <div class="error-message" *ngIf="editReclamationForm.get('descriptionRecl')?.invalid && editReclamationForm.get('descriptionRecl')?.touched">
            <span *ngIf="editReclamationForm.get('descriptionRecl')?.errors?.['required']">La description est requise</span>
            <span *ngIf="editReclamationForm.get('descriptionRecl')?.errors?.['minlength']">La description doit contenir au moins 10 caract√®res</span>
            <span *ngIf="editReclamationForm.get('descriptionRecl')?.errors?.['maxlength']">La description ne peut pas d√©passer 500 caract√®res</span>
          </div>
        </div>

        <!-- Section des fichiers existants -->
        <div class="existing-files-section" *ngIf="reclamationToEdit.captureRecl || reclamationToEdit.documentRecl">
          <h5 class="section-title">üìé Fichiers actuels</h5>
          <div class="existing-files-grid">
            <div class="existing-file-item" *ngIf="reclamationToEdit.captureRecl">
              <div class="file-icon">üì∑</div>
              <div class="file-info">
                <span class="file-name">Capture d'√©cran actuelle</span>
                <a [href]="reclamationToEdit.captureRecl" target="_blank" class="file-link">Voir le fichier</a>
              </div>
            </div>
            <div class="existing-file-item" *ngIf="reclamationToEdit.documentRecl">
              <div class="file-icon">üìÑ</div>
              <div class="file-info">
                <span class="file-name">Document actuel</span>
                <a [href]="reclamationToEdit.documentRecl" target="_blank" class="file-link">Voir le fichier</a>
              </div>
            </div>
          </div>
        </div>

        <!-- Section des nouveaux fichiers -->
        <div class="files-row">
          <!-- Nouvelle capture d'√©cran -->
          <div class="form-group file-group">
            <label class="form-label">
              <span class="label-icon">üì∑</span>
              Nouvelle capture d'√©cran (optionnel)
            </label>
            <div class="file-upload-container">
              <input 
                type="file" 
                id="editCaptureFileInput" 
                accept=".png,.jpg,.jpeg" 
                (change)="onEditCaptureFileSelected($event)"
                class="file-input"
                hidden
              >
              <button 
                type="button" 
                class="file-upload-btn"
                (click)="triggerEditCaptureUpload()"
                [disabled]="isUploadingEditCapture"
              >
                <span class="upload-icon">üì∑</span>
                <span *ngIf="!isUploadingEditCapture && !editSelectedCaptureFile">Choisir une nouvelle image</span>
                <span *ngIf="isUploadingEditCapture">üîÑ Upload...</span>
                <span *ngIf="!isUploadingEditCapture && editSelectedCaptureFile">Changer l'image</span>
              </button>
              <div class="file-info" *ngIf="editSelectedCaptureFile">
                <div class="file-details">
                  <div class="file-name">{{ editSelectedCaptureFile.name }}</div>
                  <div class="file-size">({{ formatFileSize(editSelectedCaptureFile.size) }})</div>
                </div>
                <button type="button" class="remove-file-btn" (click)="removeEditCaptureFile()">‚ùå</button>
              </div>
              <div class="upload-hint">
                <small>Formats accept√©s : PNG, JPG, JPEG (max 5MB)</small>
              </div>
              
              <!-- Pr√©visualisation de la nouvelle image -->
              <div class="file-preview" *ngIf="editSelectedCaptureFile && editCapturePreviewUrl">
                <div class="preview-header">
                  <span class="preview-icon">üëÅÔ∏è</span>
                  <span class="preview-title">Aper√ßu de la nouvelle image</span>
                </div>
                <div class="image-preview-container">
                  <img [src]="editCapturePreviewUrl" [alt]="editSelectedCaptureFile.name" class="preview-image">
                  <div class="image-overlay">
                    <button type="button" class="zoom-btn" (click)="openImagePreview(editCapturePreviewUrl, editSelectedCaptureFile.name)">
                      üîç Agrandir
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Nouveau document -->
          <div class="form-group file-group">
            <label class="form-label">
              <span class="label-icon">üìÑ</span>
              Nouveau document justificatif (optionnel)
            </label>
            <div class="file-upload-container">
              <input 
                type="file" 
                id="editDocumentFileInput" 
                accept=".pdf,.png,.jpg,.jpeg" 
                (change)="onEditDocumentFileSelected($event)"
                class="file-input"
                hidden
              >
              <button 
                type="button" 
                class="file-upload-btn"
                (click)="triggerEditDocumentUpload()"
                [disabled]="isUploadingEditDocument"
              >
                <span class="upload-icon">üìÑ</span>
                <span *ngIf="!isUploadingEditDocument && !editSelectedDocumentFile">Choisir un nouveau fichier</span>
                <span *ngIf="isUploadingEditDocument">üîÑ Upload...</span>
                <span *ngIf="!isUploadingEditDocument && editSelectedDocumentFile">Changer le fichier</span>
              </button>
              <div class="file-info" *ngIf="editSelectedDocumentFile">
                <div class="file-details">
                  <div class="file-name">{{ editSelectedDocumentFile.name }}</div>
                  <div class="file-size">({{ formatFileSize(editSelectedDocumentFile.size) }})</div>
                </div>
                <button type="button" class="remove-file-btn" (click)="removeEditDocumentFile()">‚ùå</button>
              </div>
              <div class="upload-hint">
                <small>Formats accept√©s : PDF, PNG, JPG, JPEG (max 10MB)</small>
              </div>
              
              <!-- Pr√©visualisation du nouveau document -->
              <div class="file-preview" *ngIf="editSelectedDocumentFile">
                <div class="preview-header">
                  <span class="preview-icon">üëÅÔ∏è</span>
                  <span class="preview-title">Aper√ßu du nouveau document</span>
                </div>
                
                <!-- Pr√©visualisation pour images -->
                <div class="image-preview-container" *ngIf="isImageFile(editSelectedDocumentFile.type) && editDocumentPreviewUrl">
                  <img [src]="editDocumentPreviewUrl" [alt]="editSelectedDocumentFile.name" class="preview-image">
                  <div class="image-overlay">
                    <button type="button" class="zoom-btn" (click)="openImagePreview(editDocumentPreviewUrl, editSelectedDocumentFile.name)">
                      üîç Agrandir
                    </button>
                  </div>
                </div>
                
                <!-- Pr√©visualisation pour PDF -->
                <div class="pdf-preview-container" *ngIf="isPdfFile(editSelectedDocumentFile.type)">
                  <div class="pdf-icon-large">üìÑ</div>
                  <div class="pdf-info">
                    <div class="pdf-name">{{ editSelectedDocumentFile.name }}</div>
                    <div class="pdf-size">{{ formatFileSize(editSelectedDocumentFile.size) }}</div>
                    <button type="button" class="view-pdf-btn" (click)="openPdfPreview(editSelectedDocumentFile)">
                      üìñ Ouvrir le PDF
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>

      <!-- Message si modification non autoris√©e -->
      <div class="modification-disabled-message" *ngIf="!canEditReclamation(reclamationToEdit)">
        <p>Cette r√©clamation ne peut plus √™tre modifi√©e car elle n'est plus en attente de traitement.</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="closeEditReclamationModal()">
        Annuler
      </button>
      <button 
        type="button" 
        class="btn-submit" 
        (click)="submitEditReclamation()"
        [disabled]="editReclamationForm.invalid || isEditingReclamation || !canEditReclamation(reclamationToEdit)"
        *ngIf="canEditReclamation(reclamationToEdit)"
      >
        <span *ngIf="isEditingReclamation">üîÑ Modification...</span>
        <span *ngIf="!isEditingReclamation">‚úèÔ∏è Enregistrer les modifications</span>
      </button>
    </div>
  </div>
</div>
